<meta http-equiv="X-UA-Compatible" content="chrome=1">
<link rel="stylesheet" href="http://hub.chemdoodle.com/cwc/latest/ChemDoodleWeb.css" type="text/css">
<script type="text/javascript" src="http://hub.chemdoodle.com/cwc/latest/ChemDoodleWeb.js"></script>

<script> var $=function(id){return document.getElementById(id)} </script>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<body>
<p>
Layers from faces to centre: <br/>
<script>
	for(i=1;i<=8;i++) {
		document.write("D<sub>111</sub><sup>",i,
			"</sup> <input style=\"width:50px\" type=\"box\" id=\"D111_",i,
			"\" value=\"3\" /> &nbsp;&nbsp;")
	}
</script>
<br/>
	Set all D<sub>111</sub> to <input style="width:50px" type="box" id="D111_all" value="3" />
<input type="button" value="Apply" onclick="setAllD(0)" style="font-size:12pt" /> <br/><br/>
<script>
for(i=1;i<=6;i++) {
	document.write("D<sub>002</sub><sup>",i,
		"</sup> <input style=\"width:50px\" type=\"box\" id=\"D002_",i,
		"\" value=\"2\" /> &nbsp;&nbsp;")
}
</script>
<br/>
	Set all D<sub>002</sub> to <input style="width:50px" type="box" id="D002_all" value="2" />
<input type="button" value="Apply" onclick="setAllD(1)" style="font-size:12pt" />

<br/><br/>
<input type="button" value="Generate" onclick="genNow()" style="height:50px;font-size:12pt" /></p>

<table><tr>
<td>
	<p> <input type="button" value="List coordinates" onclick="genCoor()" style="font-size:12pt" /></p>
	Atom coordinate list <br/>
	<textarea id="xyzCoor" style="width:400px; height:500px; resize: none"></textarea>
</td>
<td>
	<p> <input type="button" value="Draw from coordinates" onclick="loadMol()" style="font-size:12pt" /></p>
	3D Structure <br/>
	<script>
		var Canv=new ChemDoodle.TransformCanvas3D('Canv-1', 400,500);
		Canv.specs.backgroundColor='black';
		Canv.specs.set3DRepresentation('Ball and Stick');
		Canv.specs.projectionPerspective_3D = false;
		Canv.loadMolecule(ChemDoodle.readXYZ(""));
		$("xyzCoor").value=""
	</script>
	</figure>
</td>
</tr></table>

<script>

function setAllD(a) {
	if(a==0) {
		for(i=1;i<=8;i++) $("D111_"+i).value=$("D111_all").value
	} else {
		for(i=1;i<=6;i++) $("D002_"+i).value=$("D002_all").value
	}
}

function genCoor() {
	var D111=[], D002=[], D111_max=0;
	for(i=1;i<=8;i++) {
		D111[i]=parseInt($("D111_"+i).value)
		if(D111[i]>D111_max) D111_max=D111[i]
	}
	
	for(i=1;i<=6;i++) {D002[i]=parseInt($("D002_"+i).value)}

	var i, j, k, x, y, z, a=4.0495;
	var Ntot=0, X=[], Y=[], Z=[];
	
	for(i=-D111_max; i<=D111_max; i++) {
		for(j=-D111_max; j<=D111_max; j++) {
			for(k=-D111_max; k<=D111_max; k++) {
				x=i*a; y=j*a; z=k*a
				Ntot++; X[Ntot]=x;       Y[Ntot]=y;       Z[Ntot]=z
				Ntot++; X[Ntot]=x+0.5*a; Y[Ntot]=y+0.5*a; Z[Ntot]=z
				Ntot++; X[Ntot]=x+0.5*a; Y[Ntot]=y;       Z[Ntot]=z+0.5*a
				Ntot++; X[Ntot]=x;       Y[Ntot]=y+0.5*a; Z[Ntot]=z+0.5*a
			}
		}
	}
	
	var Natm=0, YesIn=[], a2=a/2;

	for(i=1; i<=Ntot; i++) {
		x=X[i]; y=Y[i]; z=Z[i]
		if( x+y+z<=D111[1]*a &&  x+y-z<=D111[5]*a && 
			-x+y+z<=D111[2]*a && -x+y-z<=D111[6]*a && 
			-x-y+z<=D111[3]*a && -x-y-z<=D111[7]*a && 
			x-y+z<=D111[4]*a &&  x-y-z<=D111[8]*a && 
			-D002[1]*a2<=x && x<=D002[2]*a2 && 
			-D002[3]*a2<=y && y<=D002[4]*a2 && 
			-D002[5]*a2<=z && z<=D002[6]*a2) {
			
			Natm=Natm+1; YesIn[i]=1
		}
	}

	var Fmol=Natm+"\n"
	Fmol+="Atom    X           Y           Z\n"
	for(i=1; i<=Ntot; i++) {
		if(YesIn[i]) {
			if(X[i]==0 && Y[i]==0 && Z[i]==0) {
				Fmol += "H  "+fmtNum(X[i],12.6)+fmtNum(Y[i],12.6)+fmtNum(Z[i],12.6)+"\n"
			} else {
				Fmol += "Al  "+fmtNum(X[i],12.6)+fmtNum(Y[i],12.6)+fmtNum(Z[i],12.6)+"\n"
			}
		}
	}
	$("xyzCoor").value=Fmol
}

function loadMol() {
	Fmol=$("xyzCoor").value
	Canv.loadMolecule(ChemDoodle.readXYZ(Fmol));
}

function genNow() {
	genCoor(); loadMol()
}

function fmtNum(num, fmt) {
	var fmt=String(fmt), m=fmt.split(".")[0]
	num=num.toFixed(fmt.split(".")[1])
	if(num.length<m) num=Array(m-num.length+1).join(" ")+num
	return num
}

function fmtStr(str, fmt) {
	if(str.length<fmt) str += Array(fmt-str.length+1).join(" ")
	return str
}

</script>

</body>
</html>


