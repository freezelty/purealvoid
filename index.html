<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Void in Pure Aluminum</title>
</head>

<meta http-equiv="X-UA-Compatible" content="chrome=1">
<link rel="stylesheet"
	href="http://hub.chemdoodle.com/cwc/latest/ChemDoodleWeb.css"
	type="text/css">
<script type="text/javascript"
	src="http://hub.chemdoodle.com/cwc/latest/ChemDoodleWeb.js"></script>
<script> var $=function(id){return document.getElementById(id)} 
var FL=[["  "],[" 1  1  1"],[" 1  1 -1"],[" 1 -1  1"],[" 1 -1 -1"],
		["-1  1  1"],["-1  1 -1"],["-1 -1  1"],["-1 -1 -1"],
		[" 2  0  0"],["-2  0  0"],[" 0  2  0"],[" 0 -2  0"],[" 0  0  2"],[" 0  0 -2"]];
</script>

<style>
</style>

<body>
	<table>
		<tbody>
			<tr>
				<td><table style="font-size: 12pt">
						<tbody>
							<tr>
								<th>Distances (atom layers) from centre:</th>
							</tr>
							<tr>
								<td><table style="text-align: right; text-indent: 5px">
										<tbody>
											<tr>
												<td><button type="button" style="font-size: 10pt"
														onclick="setAllD(0)">Set D{111}</button></td>
												<td>1. D(111) = <input style="width: 50px" id="D111_1"
													value="3" type="text">
												</td>
												<td>2. D(111̅) = <input style="width: 50px" id="D111_2"
													value="3" type="text">
												</td>
												<td>3. D(11̅1) = <input style="width: 50px" id="D111_3"
													value="3" type="text">
												</td>
												<td>4. D(11̅1̅) = <input style="width: 50px"
													id="D111_4" value="3" type="text">
												</td>
											</tr>
											<tr>
												<td style="text-align: center""><input
													style="width: 50px" id="D111_all" value="3" type="text"></td>
												<td>5. D(1̅11) = <input style="width: 50px" id="D111_5"
													value="3" type="text">
												</td>
												<td>6. D(1̅11̅) = <input style="width: 50px"
													id="D111_6" value="3" type="text">
												</td>
												<td>7. D(1̅1̅1) = <input style="width: 50px"
													id="D111_7" value="3" type="text">
												</td>
												<td>8. D(1̅1̅1̅) = <input style="width: 50px"
													id="D111_8" value="3" type="text">
												</td>
											</tr>
										</tbody>
									</table> <br />
									<table style="text-align: right; text-indent: 5px">
										<tbody>
											<tr>
												<td><button type="button" style="font-size: 10pt"
														onclick="setAllD(1)">Set D{002}</button></td>
												<td>9. D(200) = <input style="width: 50px" id="D002_1"
													value="4" type="text">
												</td>
												<td>11. D(020) = <input style="width: 50px" id="D002_3"
													value="4" type="text">
												</td>
												<td>13. D(002) = <input style="width: 50px" id="D002_5"
													value="4" type="text">
												</td>
											</tr>
											<tr>
												<td style="text-align: center"><input
													style="width: 50px" id="D002_all" value="4" type="text"></td>
												<td>10. D(2̅00) = <input style="width: 50px"
													id="D002_2" value="4" type="text">
												</td>
												<td>12. D(02̅0) = <input style="width: 50px"
													id="D002_4" value="4" type="text">
												</td>
												<td>14. D(002̅) = <input style="width: 50px"
													id="D002_6" value="4" type="text">
												</td>
											</tr>
										</tbody>
									</table></td>
							</tr>
						</tbody>
					</table></td>
				<td style="text-align: left">
					<table style="text-align: center">
						<tbody>
							<tr>
								<td>One click<br /> <input value="Generate"
									onclick="genNow()" style="font-size: 12pt; height: 41px"
									type="button"><br />
								</td>
								
							</tr>
							<tr>
								<td><br />Or separately<br />
									<button type="button" style="font-size: 12px"
										onclick="genCoor(getAllD())">
										List<br />Coordinates
									</button> <br />
									<button type="button" style="font-size: 12px"
										onclick="loadMol('field1',Canv1)">
										Draw<br />Field 1
									</button>
									<button type="button" style="font-size: 12px"
										onclick="loadMol('field2',Canv2)">
										Draw<br />Field 2
									</button> <br /></td>
								
							</tr>
						</tbody>
					</table>
				</td>
				<td style="text-align: center">Evolute steps:<br /> <input style="width: 50px"
									id="spEv" value="10" type="text"><br /> <input
									value="Evolute" onclick="cdEv=Evolute($('spEv').value)"
									style="font-size: 12pt; height: 41px" type="button"><br />
									<button type="button" style="font-size: 12px"
										onclick="prtCoor(cdEv[--iEv],'field1');loadMol('field1',Canv1)">&lt;
									</button>
									<button type="button" style="font-size: 12px"
										onclick="prtCoor(cdEv[++iEv],'field1');loadMol('field1',Canv1)">&gt;
									</button><br /></td>
			</tr>
		</tbody>
	</table>
	<table style="vertical-align: top">
		<tbody>
			<tr>
				<th>Field 1 <select id="field1_opt" style="font-size: 12px">
						<option value=0 selected="selected">Solid shape</option>
						<option value=1>Faces only</option>
				</select></th>
				<th>Field 2 <select id="field2_opt" style="font-size: 12px">
						<option value=0>Solid shape</option>
						<option value=1>Faces only</option>
						<option value=2 selected="selected">Edges only</option>
						<option value=3>Vertices</option>
				</select></th>
				<th>Results</th>
			</tr>
			<tr>
				<td style="vertical-align: top"><script>
					var Canv1=new ChemDoodle.TransformCanvas3D('Canv1-1', 350,350);
					Canv1.specs.backgroundColor='black';
					Canv1.specs.set3DRepresentation('Ball and Stick');
					Canv1.specs.projectionPerspective_3D = false;
					Canv1.loadMolecule(ChemDoodle.readXYZ(""));
				</script> <br /> <textarea id="field1" style="width: 350px; height: 200px"></textarea></td>
				<td style="vertical-align: top"><script>
					var Canv2=new ChemDoodle.TransformCanvas3D('Canv1-2', 350,350);
					Canv2.specs.backgroundColor='black';
					Canv2.specs.set3DRepresentation('Stick');
					Canv2.specs.projectionPerspective_3D = false;
					Canv2.loadMolecule(ChemDoodle.readXYZ(""));
				</script> <br /> <textarea id="field2" style="width: 350px; height: 200px"></textarea></td>
				<td style="vertical-align: top; text-align: justify"><script>
						document.write("<p id=\"DAtot\" style=\"font-size: 10pt; font-family: Courier;")
						document.write("white-space: pre\">Area{111} =\nArea{002} = \n    Total = </p>")
						document.write("<table style=\"font-size: 10pt; font-family: Courier;")
						document.write("text-align: right; white-space: pre\">")
						document.write("<thead style=\"text-align: center\"><tr><th>No. </th><th>Face</th>")
						document.write("<th colspan=\"2\">  Area</th><th colspan=\"2\">  Actual Dist.</th></thead>")
						document.write("<tr style=\"text-align: center\"><td></td><td></td><td>  rel.</td>")
						document.write("<td>  &#8491;<sup>2</sup></td><td>  rel.</td><td>  &#8491;</td></tr>")
						for(var i=1;i<=14;i++) {
							document.write("<tr><td>"+i+". </td><td>  "+FL[i]+"</td>")
							document.write("<td id=\"DrA_"+i+"\">  </td><td id=\"DaA_"+i+"\">  </td>")
							document.write("<td id=\"DrD_"+i+"\">  </td><td id=\"DaD_"+i+"\">  </td></tr>")
						}
						document.write("</table>")
						</script> <textarea id="field_area" style="width: 450px; height: 180px"></textarea></td>
			</tr>
		</tbody>
	</table>

	<script>
	$("field1").value=""
	$("field2").value=""
	$("field_area").value=""
// 		var D111=[], D002=[], BDY=[];
	var x, y, z, a=4.0495;
	var nOnF, n1=0, n2=0, cd1=[], cd2=[]; 
	var onFace=[], cdVF=[], nVF=[], cdEv=[], iEv=0, sEv=0
	var areaF=[], area1=0, area2=0, lsA="";
	
function setAllD(p) {
	if(p==0) for(i=1;i<=8;i++) $("D111_"+i).value=$("D111_all").value
	else for(i=1;i<=6;i++) $("D002_"+i).value=$("D002_all").value
}

function getAllD() {
	var BDY=[]
	for(var i=1;i<=8;i++) BDY[i]=parseInt($("D111_"+i).value)
	for(var i=1;i<=6;i++) BDY[i+8]=parseInt($("D002_"+i).value)
	
	return actualBDY(BDY)
}

function actualBDY(BDY) {
	var aBDY=[]

	aBDY[1]=Math.min(calD111(9,11,13,BDY),BDY[1])
	aBDY[2]=Math.min(calD111(9,11,14,BDY),BDY[2])
	aBDY[3]=Math.min(calD111(9,12,13,BDY),BDY[3])
	aBDY[4]=Math.min(calD111(9,12,14,BDY),BDY[4])
	aBDY[5]=Math.min(calD111(10,11,13,BDY),BDY[5])
	aBDY[6]=Math.min(calD111(10,11,14,BDY),BDY[6])
	aBDY[7]=Math.min(calD111(10,12,13,BDY),BDY[7])
	aBDY[8]=Math.min(calD111(10,12,14,BDY),BDY[8])
	aBDY[9]=Math.min(BDY[1]+BDY[4], BDY[2]+BDY[3], BDY[9])
	aBDY[10]=Math.min(BDY[5]+BDY[8], BDY[6]+BDY[7], BDY[10])
	aBDY[11]=Math.min(BDY[1]+BDY[6], BDY[2]+BDY[5], BDY[11])
	aBDY[12]=Math.min(BDY[3]+BDY[8], BDY[4]+BDY[7], BDY[12])
	aBDY[13]=Math.min(BDY[1]+BDY[7], BDY[3]+BDY[5], BDY[13])
	aBDY[14]=Math.min(BDY[2]+BDY[8], BDY[4]+BDY[6], BDY[14])
	
	return aBDY
}

function calD111(b1,b2,b3, BDY) {
	var s=BDY[b1]+BDY[b2]+BDY[b3];
	return Math.floor(s/2)
}

function FCC(x1,y1,z1,i) {
	if(i==0) return [    x1,     y1,     z1];
	if(i==1) return [0.5+x1, 0.5+y1,     z1];
	if(i==2) return [0.5+x1,     y1, 0.5+z1];
	if(i==3) return [    x1, 0.5+y1, 0.5+z1];
}

function genCoor(BDY) {
	lsA=""; n1=0; n2=0; cd1=[]; cd2=[]; areaF=[]; area1=0, area2=0 
	for(var i=1;i<=14;i++) {cdVF[i]=[]; nVF[i]=0}
	
	for(var x0=-Math.ceil(BDY[10]/2); x0<=BDY[9]/2; x0++) {
		for(var y0=-Math.ceil(BDY[12]/2); y0<=BDY[11]/2; y0++) {
			for(var z0=-Math.ceil(BDY[14]/2); z0<=BDY[13]/2; z0++) {
				for (var i=0; i<4; i++) {
					[x,y,z]=FCC(x0,y0,z0,i)

					if(  BDY[1]+0.1>x+y+z && BDY[5]+0.1>-x+y+z && 
							BDY[2]+0.1>x+y-z && BDY[6]+0.1>-x+y-z && 
							BDY[3]+0.1>x-y+z && BDY[7]+0.1>-x-y+z && 
							BDY[4]+0.1>x-y-z && BDY[8]+0.1>-x-y-z && 
							BDY[ 9]/2+0.1>x   && -BDY[10]/2-0.1<x   && 
							BDY[11]/2+0.1>y   && -BDY[12]/2-0.1<y   && 
							BDY[13]/2+0.1>z   && -BDY[14]/2-0.1<z) 
					{
						nOnF=0; onFace=[]
						if(BDY[1]== x+y+z) {onFace[1]=1;nOnF++}
						if(BDY[2]== x+y-z) {onFace[2]=1;nOnF++}
						if(BDY[3]== x-y+z) {onFace[3]=1;nOnF++}
						if(BDY[4]== x-y-z) {onFace[4]=1;nOnF++}
						if(BDY[5]==-x+y+z) {onFace[5]=1;nOnF++}
						if(BDY[6]==-x+y-z) {onFace[6]=1;nOnF++}
						if(BDY[7]==-x-y+z) {onFace[7]=1;nOnF++}
						if(BDY[8]==-x-y-z) {onFace[8]=1;nOnF++}
						if(BDY[ 9]/2== x)   {onFace[ 9]=1;nOnF++}
						if(BDY[10]/2==-x)   {onFace[10]=1;nOnF++}
						if(BDY[11]/2== y)   {onFace[11]=1;nOnF++}
						if(BDY[12]/2==-y)   {onFace[12]=1;nOnF++}
						if(BDY[13]/2== z)   {onFace[13]=1;nOnF++}
						if(BDY[14]/2==-z)   {onFace[14]=1;nOnF++}
					
						//debug info
// 						lsA+="\n"+(x+y+z)+"\t"+(-x+y+z)+"\t"+( x+y-z)+"\t"+(-x+y-z)+"\t"+(x-y+z)+"\t"+
// 								(-x-y+z)+"\t"+( x-y-z)+"\t"+(-x-y-z)+"\t"+x+"\t"+(y)+"\t"+(z)+"\t"+nOnF+"\n"
						
						if(nOnF>=$("field1_opt").value) cd1[++n1]=[x,y,z];
						if(nOnF>=$("field2_opt").value) cd2[++n2]=[x,y,z];
						
						for(var j=1; j<=14; j++) 
							if(onFace[j] && nOnF>=3) 
								cdVF[j][++nVF[j]]=[x,y,z];
					}
				}
			}
		}
	}
	
	prtCoor(cd1,"field1")
	prtCoor(cd2,"field2")
	
	areaF=calArea(BDY)
	for(var i=1; i<=14; i++) {
// 		areaF[i]=calAreaTri(nVF[i],cdVF[i]);
		if(i<=8) area1+=areaF[i];
		else area2+=areaF[i];
	}
	
	var NL=2, aA, rA, aD, DAtotT="", area3=area1+area2, as=a*a
	var totEng=(area1*6.552*as+area2*6.864*as)/100
	var area11=(area1*as).toFixed(NL), area21=(area2*as).toFixed(NL)
	var area31=(area3*as).toFixed(NL)
			
			
	area1=area1.toFixed(NL), area2=area2.toFixed(NL), area3=area3.toFixed(NL)
	
	DAtotT =  "Area{111} = "+area1+" &times; 4.0495<sup>2</sup> = "+
			area11+" &#8491;<sup>2</sup>"; 
	DAtotT+="\nArea{002} = "+area2+" &times; 4.0495<sup>2</sup> = "+
			area21+" &#8491;<sup>2</sup>";
	DAtotT+="\n    Total = "+area3+" &times; 4.0495<sup>2</sup> = "+
			area31+" &#8491;<sup>2</sup>";
	DAtotT+="\nTotal Surface Energy = "+totEng.toFixed(NL)+" eV";
	$("DAtot").innerHTML=DAtotT
	
	lsA+="\nArea{111} = "+area1+" * 4.0495^2 = "+area11+" Å^2"
	lsA+="\nArea{002} = "+area2+" * 4.0495^2 = "+area21+" Å^2"
	lsA+="\n    Total = "+area3+" * 4.0495^2 = "+area31+" Å^2\n"
	lsA+="\nNo.  Face    \tArea\t\tActual Dist."
	lsA+="\n          \trel.\tÅ^2\trel.\tÅ"
	
	for(var i=1; i<=14; i++) {
		aA=(as*areaF[i]).toFixed(NL), rA=areaF[i].toFixed(NL)
		if(i<=8) aD=(BDY[i]*a/Math.sqrt(3)).toFixed(NL)
		else aD=(BDY[i]*a/2).toFixed(NL)
		$("DrA_"+i).innerHTML="  "+rA; $("DaA_"+i).innerHTML="  "+aA; 
		$("DrD_"+i).innerHTML="  "+BDY[i]; $("DaD_"+i).innerHTML="  "+aD; 
		lsA+="\n"+fmtStr(i+".",4)+FL[i]+"\t"+rA+"\t"+aA+"\t"+BDY[i]+"\t"+aD
	}
	
	$("field_area").value=n1+" "+totEng
	return [n1, totEng, cd1]
}

function prtCoor(cd,field){
	var ls="\nAtom    X           Y           Z\nH  "+fmtcdNum([0,0,0],12.5,a)+"\n", cen=1, n=cd.length-1;
	
	for(i=1; i<=n; i++) {
		if(cd[i][0]==0 && cd[i][1]==0 && cd[i][2]==0) cen=0;
		else ls += "Al "+fmtcdNum(cd[i],12.5,a)+"\n";
	}
	ls=(n+cen)+ls;
	
	$(field).value=ls
}

function Evolute(sEv) {
	var n0, ni, n1, Eng0, Engi, Eng1, out0, out1, outi, maxDelta=0, Delta=0, 
			DD=1, i1=1, BDYi=[], BDY=[];
	var j=1;
	var cdEv=[], iEv=0
	
	BDY=getAllD()
	out0=genCoor(BDY);
	cdEv[0]=out0[2]
	console.log(out0[0]+"\t"+out0[1])
	while (out0[0]>0 && j<=sEv) {
		maxDelta=0, i1=1
		for(var i=1; i<=14; i++) {
			BDYi=BDY.slice(), BDYi[i]=BDY[i]-1, BDYi=actualBDY(BDYi)
			outi=genCoor(BDYi)
			Delta=(out0[1]-outi[1])/(out0[0]-outi[0])
			if(Delta>maxDelta || (Delta==maxDelta && BDY[i]>BDY[i1])) {
				console.log(maxDelta.toFixed(2)+" * "+Delta.toFixed(2)+"\t"+i1+"\t"+i+"\t"+BDYi);
				i1=i, out1=outi.slice(), maxDelta=Delta;
			}
			else 
				console.log(maxDelta.toFixed(2)+"   "+Delta.toFixed(2)+"\t"+i1+"\t"+i+"\t"+BDYi);
		}
		
		out0=out1.slice(); BDY[i1]=BDY[i1]-1, BDY=actualBDY(BDY)
		if (out0[0]>0) cdEv[++iEv]=out0[2];
		console.log("Step "+j+"\t"+out0[0]+"\t"+out0[1].toFixed(2)+"\t"+maxDelta.toFixed(2)+"\t"+i1+"\t"+BDY);
		j++
	}
	
	return cdEv
}

function dispEv(iEv) {
	console.log(iEv)
// 	prtCoor(cdEv[iEv1],"field1")
}

function calAreaTri(N,cd) {
	var s, area=0
	if(N>2) {
		sortVrt(1,N,cd)
	
		for(var i=2; i<=N-1; i++) {
			var l1=calLen(1,i,cd), l2=calLen(1,i+1,cd), l3=calLen(i,i+1,cd)
			var s=(l1+l2+l3)/2
			area+=Math.sqrt(s*(s-l1)*(s-l2)*(s-l3))
		}
	}
	return area
}

function calArea(BDY) {
	var MS1=[], MS2=[], areaF=[], a=Math.sqrt(3)/8

	MS1[1]=BDY[1]-BDY[2]-BDY[3]-BDY[5]
	MS1[2]=BDY[2]-BDY[1]-BDY[4]-BDY[6]
	MS1[3]=BDY[3]-BDY[1]-BDY[4]-BDY[7]
	MS1[4]=BDY[4]-BDY[2]-BDY[3]-BDY[8]
	MS1[5]=BDY[5]-BDY[1]-BDY[6]-BDY[7]
	MS1[6]=BDY[6]-BDY[2]-BDY[5]-BDY[8]
	MS1[7]=BDY[7]-BDY[3]-BDY[5]-BDY[8]
	MS1[8]=BDY[8]-BDY[4]-BDY[6]-BDY[7]
	
	MS2[1]=BDY[9]-BDY[1]-BDY[4]
	MS2[2]=BDY[9]-BDY[2]-BDY[3]
	MS2[3]=BDY[10]-BDY[5]-BDY[8]
	MS2[4]=BDY[10]-BDY[6]-BDY[7]
	MS2[5]=BDY[11]-BDY[1]-BDY[6]
	MS2[6]=BDY[11]-BDY[2]-BDY[5]
	MS2[7]=BDY[12]-BDY[3]-BDY[8]
	MS2[8]=BDY[12]-BDY[4]-BDY[7]
	MS2[9]=BDY[13]-BDY[1]-BDY[7]
	MS2[10]=BDY[13]-BDY[3]-BDY[5]
	MS2[11]=BDY[14]-BDY[2]-BDY[8]
	MS2[12]=BDY[14]-BDY[4]-BDY[6]
	
	areaF[9]=MS2[1]*MS2[2]/2
	areaF[10]=MS2[3]*MS2[4]/2
	areaF[11]=MS2[5]*MS2[6]/2
	areaF[12]=MS2[7]*MS2[8]/2
	areaF[13]=MS2[9]*MS2[10]/2
	areaF[14]=MS2[11]*MS2[12]/2

	for(var i=1;i<=8;i++) MS1[i]=MS1[i]*MS1[i];
	for(var i=1;i<=12;i++) MS2[i]=MS2[i]*MS2[i];
	
	areaF[1]=(MS1[1]-(MS2[2]+MS2[6]+MS2[10]))*a
	areaF[2]=(MS1[2]-MS2[1]-MS2[5]-MS2[12])*a
	areaF[3]=(MS1[3]-MS2[1]-MS2[8]-MS2[9])*a
	areaF[4]=(MS1[4]-MS2[2]-MS2[7]-MS2[11])*a
	areaF[5]=(MS1[5]-MS2[4]-MS2[5]-MS2[9])*a
	areaF[6]=(MS1[6]-MS2[3]-MS2[6]-MS2[11])*a
	areaF[7]=(MS1[7]-MS2[3]-MS2[7]-MS2[10])*a
	areaF[8]=(MS1[8]-MS2[4]-MS2[8]-MS2[12])*a
	
	return areaF
}

function sortVrt(iV0,N,cd) {
	var iV1=iV0+1, x, y, z;
	var l0=calLen(iV0,iV1,cd), l1
	for(var i=iV1+1; i<=N; i++) {
		l1=calLen(iV0,i,cd)
		if(l1<l0) {l0=l1; iV1=i}
	}
	
	[x,y,z]=cd[iV0+1]; 
	cd[iV0+1]=cd[iV1]; 
	cd[iV1]=[x,y,z]
	
	if(iV0+2<N) sortVrt(iV0+1,N,cd);
}

function calLen(i1,i2,cd) {
	var lx=Math.pow(Math.abs(cd[i1][0]-cd[i2][0]),2)
	var ly=Math.pow(Math.abs(cd[i1][1]-cd[i2][1]),2)
	var lz=Math.pow(Math.abs(cd[i1][2]-cd[i2][2]),2)
	return Math.sqrt(lx+ly+lz)
}

function loadMol(field,Canv) {
	var ls=$(field).value
	Canv.loadMolecule(ChemDoodle.readXYZ(ls));
	Canv.specs.compass_display = true;
}

function genNow() {
	$("field1").value=""; $("field2").value=""; $("field_area").value=""
	var cdEv=[]
	genCoor(getAllD(),cdEv); loadMol("field1",Canv1); loadMol("field2",Canv2)
}

function fmtcdNum(cd, fmt, a) {
	var fmtcd=[]
	for(var i=0; i<3; i++) fmtcd[i]=fmtNum(cd[i]*a, fmt);
	return fmtcd
}

function fmtNum(num, fmt) {
	var fmt=String(fmt), m=fmt.split(".")[0]
	num=num.toFixed(fmt.split(".")[1])
	if(num.length<m) num=Array(m-num.length+1).join(" ")+num
	return num
}

function fmtStr(str, fmt) {
	if(str.length<fmt) str += Array(fmt-str.length+1).join(" ")
	return str
}

</script>
</body>
</html>